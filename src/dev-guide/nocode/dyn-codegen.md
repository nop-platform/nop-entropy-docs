# 动态模型代码生成

## 动态模型

nop-dyn模块提供在线模型定义。在DynCodeGen类中，初始化的时候会自动读取dyn配置，并在内存中生成meta和biz定义。

如果启动的时候希望跳过模型生成，可以配置`nop.dyn.gen-code-when-init`为false。

动态模型如果也支持多租户，则会导致同样的实体名对应的数据库结构不同

## 动态更新

动态模型允许动态修改和更新，模型更新后所有根据模型自动推导得到的信息也需要连带更新，因此需要有必要精确定义模型变动所影响的范围。

模型加载使用响应式的动态生成加载器: 当按照名称进行加载时，动态生成模型文件再进行解析，解析结果在内存中缓存

### 租户和模块

* 每个租户具有自己独立管理的模型缓存，由TenantAwareResourceLoadingCache提供相关实现。
* 每个租户对应于一个Delta文件存储，在这个ResourceStore中再按照模块前缀进行切分，每个模块的文件可以单独加载和更新。

### 对象切分

* 对象结构是业务含义明确的分解结构，一个对象相关的各个模型往往会出现紧密的相互引用，可以按照对象作为最小的更新粒度。
* meta、view和page等都是针对单实体可以进行缓存管理，每次修改更新单对象相关文件即可
* ORM模型允许实体引用，但是考虑到动态更新，原则上不跨模块进行相互引用。

## 发布

* 点击【发布】按钮，会调用DynCodeGen在内存中生成模型文件。模型和模型文件可以导出，作为普通模块来管理和使用。
* 在模块发布之前可以设计和测试模型，发布仅仅是让它对外部可见。区分【未部署】、【已部署】和【已发布】等状态
